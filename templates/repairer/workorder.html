{% extends '_base.html' %}
{% load static %}

{% block title %}Repairer Clock Info{% endblock title %}

{% block content %}

{% if user.is_authenticated %}
<div class="row">
  <div class="col">
    <link rel="stylesheet" href="{% static 'css/workorder.css' %}">

    <div class="invoice-box">
        <table cellpadding="0" cellspacing="0">
            <tr class="top">
                <td colspan="2">
                    <table>
                        <tr>
                            <td colspan="2">
                                {% if clock.id %}
                                <a href="{% url 'repairer_clock' clock.id %}">{{ clock.nickname }}</a><br>
                                {% else %}
                                {{ clock.nickname }}<br>
                                {% endif %}
                                {{ workorder.date_created }}<br>
                                ID: {{ workorder.id }}<br>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            
            <tr class="information">
                <td colspan="2">
                    <table>
                        <tr>
                            <td>
                                <a href="{% url 'repairer_about' workorder.repairer_fk_id %}">{{ repairer.first_name }} {{ repairer.last_name }}</a><br>
                                {{ repairer.address_street }}
                                {% if repairer.address_other %}
                                , {{ repairer.address_other }}
                                {% endif %}
                                <br>{{ repairer.city }}, {{ repairer.state }} {{ repairer.zipcode }}
                                <br>{{ repairer.phone_number.as_national }}
                            </td>
                            <td>
                                {{ customer.first_name }} {{ customer.last_name }}<br>
                                {{ customer.address_street }}
                                    {% if customer.address_other %}
                                    {{ customer.address_other }}
                                    {% endif %}
                                    <br>{{ customer.city }}, {{ customer.state }} {{ customer.zipcode }}
                                    <br>{{ customer.phone_number.as_national }}
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <!-- Description lines -->
            <tr class="heading">
                <td colspan=2>Repair Description</td>
            </tr>
            <tr class="details">
                <td colspan=2>{{ workorder.repair_description }}</td>
            </tr>
            <tr class="heading">
                <td>Repair Status</td>
                <td>Last Updated</td>
            </tr>
            <tr class="details">
                <td>{{ workorder.get_repair_status_display }}</td>
                <td>{{ workorder.date_last_updated }}</td>
            </tr>
            <!-- Payment lines -->
            {% if workorder.repair_status == 'Paid in Full' %}
            <tr class="heading">
                <td>Payment Method</td>
                <td>USD</td>
            </tr>
            <tr class="details">
                <td></td>
                <td></td>
            </tr>
            {% endif %}                    
            <!-- Line items headline -->
            <tr class="heading">
                <td>
                    <form action="{% url 'repairer_addons_add' %}" method="post">
                        {% csrf_token %}
                        <!-- Begin Hidden Fields -->
                        <!-- manually entered -->
                        <input type='hidden' id='workorder_fk' name='workorder_fk' value='{{ workorder.id }}'>
                        <input type='hidden' id='repair_status_update' name='repair_status_update' value='{{ workorder.repair_status }}'>
                        <input type='hidden' id='added_hours' name='added_hours' value=0>
                        <input type="hidden" id="added_part_cost_0" name="added_part_cost_0" value=0>
                        <input type="hidden" id="added_part_cost_1" name="added_part_cost_1" value="USD">
                        Item <input class='btn btn-link' type='submit' value="+">
                      </form>
                </td>
                <td>Price</td>
            </tr>
            <!-- Initial estimate -->
            <tr class="item">
                <td>
                    {{ workorder.repair_type }} - 
                    {% if debug.repairer_estimate %}
                        (Repairer Estimated)
                    {% else %}
                        (Dynamically Estimated)
                    {% endif %}                    
                </td>
                <td>
                    {% if debug.repairer_estimate %}
                        {{ debug.repairer_estimate }}
                    {% else %}
                        {{ workorder.dynamic_estimate  }}
                    {% endif %}                    
                </td>
            </tr>
            <!-- Line items -->
            <!-- Loop over the following with original estimate + addons -->

            <!-- <tr class="item last">
                <td>
                    Domain name (1 year)
                </td>
                <td>
                    $10.00
                </td>
            </tr> -->
            
            <!-- Total Row -->
            <!-- <tr class="total">
                <td></td>
                <td>
                Total: $###.##
                </td>
            </tr> -->
        </table>
    </div>
    {% if addons %}
    <br>
    <div class="col-md-6">
        <hr>
        <h5>Additional Information</h5>
        <hr>
    </div>  
    {% for addon in addons %}
  <div class="col">
    <div class="invoice-box">
        <table cellpadding="0" cellspacing="0">
            <tr class="top">
                <td colspan="2">
                    <table>
                        <tr>
                            <td colspan="2">
                                <a href="">{{ addon.id }}</a><br>
                                {{ addon.date_created }}<br>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            
            <!-- Repair Status  -->
            <tr class="heading">
                <td>Previous Status</td>
                <td>New Status</td>
            </tr>
            <tr class="details">
                <td>{{ addon.get_repair_status_previous_display }}</td>
                <td>{{ addon.get_repair_status_update_display }}</td>
            </tr>

            <!-- Description lines -->
            <tr class="heading">
                <td colspan=2>Description</td>
            </tr>
            <tr class="details">
                <td colspan=2>{{ addon.addon_description }}</td>
            </tr>

            <!-- Payment lines -->
            {% if addon.added_hours > 0 %}
            <tr class="heading">
                <td>Additional Work Required</td>
                <td>Hours</td>
            </tr>
            <tr class="details">
                <td>{{ addons.addon_type }}</td>
                <td>{{ addons.added_hours }}</td>
            </tr>
            {% endif %}                    

            <!-- Images -->
            {% if addon.image_1 or addon.image_2 or addon.image_3 or addon.image_4 or addon.image_5 %}
                <tr class="heading">
                    <td colspan="2">Pictures</td>
                </tr>
                {% if addon.image_1 %}
                    <tr class="details">
                        <td>
                            <img class="img-thumbnail" 
                            src="{{addon.image_1.url}}" 
                            alt="image_1" 
                            onclick="window.open('{{addon.image_1.url}}', '_blank');"\>
                        </td>
                        {% if addon.image_2 %}
                            <td colspan="2">
                                <img class="img-thumbnail" 
                                src="{{addon.image_2.url}}" 
                                alt="image_2" 
                                onclick="window.open('{{addon.image_2.url}}', '_blank');"\>
                            </td>
                        {% endif %}
                    </tr>
                {% endif %}
                {% if addon.image_3 %}
                    <tr class="details">
                        <td>
                            <img class="img-thumbnail" 
                            src="{{addon.image_3.url}}" 
                            alt="image_3" 
                            onclick="window.open('{{addon.image_3.url}}', '_blank');"\>
                        </td>
                        {% if addon.image_3 %}
                            <td colspan="2">
                                <img class="img-thumbnail" 
                                src="{{addon.image_3.url}}" 
                                alt="image_3"
                                onclick="window.open('{{addon.image_3.url}}', '_blank');"\>
                            </td>
                        {% endif %}
                    </tr>
                {% endif %}
                {% if addon.image_5 %}
                    <tr class="details">
                        <td>
                            <img class="img-thumbnail" 
                            src="{{addon.image_5.url}}" 
                            alt="image_5" 
                            onclick="window.open('{{addon.image_5.url}}', '_blank');"\>
                        </td>
                        <td></td>
                    </tr>
                {% endif %}

            {% endif %}

        </table>
    </div>
</div>
<hr>
{% endfor %}
{% else %}
    No Addons
    {% if debug.exception %}
    Debug Except ({{ debug.exception }})
    {% endif %}
{% endif %}

{% endif %}

{% endblock content %}
